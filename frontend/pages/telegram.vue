<template>
  <div class="min-h-screen bg-gray-50 py-6">
    <div class="max-w-4xl mx-auto sm:px-6 lg:px-8">
      <div class="px-4 sm:px-0">
        <!-- Header -->
        <div class="mb-8">
          <h1 class="text-2xl font-semibold text-gray-900">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Telegram ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h1>
          <p class="mt-2 text-sm text-gray-700">
            ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ Telegram Bot ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏
          </p>
        </div>

        <!-- Step 1: Bot Setup -->
        <div class="bg-white shadow rounded-lg mb-6">
          <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900">ü§ñ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á Telegram Bot</h3>
          </div>
          <div class="p-6">
            <div class="bg-blue-50 border border-blue-200 rounded-md p-4 mb-4">
              <h4 class="font-medium text-blue-900 mb-2">‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏£‡πâ‡∏≤‡∏á Bot:</h4>
              <ol class="list-decimal list-inside text-sm text-blue-800 space-y-1">
                <li>‡πÄ‡∏õ‡∏¥‡∏î Telegram ‡∏´‡∏≤ <strong>@BotFather</strong></li>
                <li>‡∏û‡∏¥‡∏°‡∏û‡πå: <code>/newbot</code></li>
                <li>‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ Bot: <strong>Phone Management Bot</strong></li>
                <li>‡∏ï‡∏±‡πâ‡∏á Username: <strong>PhoneManagementBot_[‡πÄ‡∏•‡∏Ç‡∏™‡∏∏‡πà‡∏°]</strong></li>
                <li>‡πÄ‡∏Å‡πá‡∏ö <strong>Bot Token</strong> ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤</li>
              </ol>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Bot Token</label>
              <div class="flex">
                <input
                  v-model="botToken"
                  type="password"
                  placeholder="123456789:ABCdefGHIjklMNOpqrsTUVwxyZ"
                  class="flex-1 rounded-l-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                />
                <button
                  @click="testBot"
                  :disabled="!botToken || testingBot"
                  class="inline-flex items-center px-4 py-2 border border-l-0 border-gray-300 rounded-r-md bg-gray-50 text-sm font-medium text-gray-700 hover:bg-gray-100 disabled:opacity-50"
                >
                  <span v-if="testingBot">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...</span>
                  <span v-else>‡∏ó‡∏î‡∏™‡∏≠‡∏ö Bot</span>
                </button>
              </div>
              <div v-if="botInfo" class="mt-2 text-sm text-green-600">
                ‚úÖ Bot: {{ botInfo.result?.first_name }} (@{{ botInfo.result?.username }})
              </div>
              <div v-if="botError" class="mt-2 text-sm text-red-600">
                ‚ùå {{ botError }}
              </div>
            </div>
          </div>
        </div>

        <!-- Step 2: Group Setup -->
        <div class="bg-white shadow rounded-lg mb-6">
          <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900">üë• ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡πÄ‡∏û‡∏¥‡πà‡∏° Bot ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°</h3>
          </div>
          <div class="p-6">
            <div class="bg-yellow-50 border border-yellow-200 rounded-md p-4 mb-4">
              <h4 class="font-medium text-yellow-900 mb-2">‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏û‡∏¥‡πà‡∏° Bot ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°:</h4>
              <ol class="list-decimal list-inside text-sm text-yellow-800 space-y-1">
                <li>‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° Telegram ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</li>
                <li>‡∏Ñ‡∏•‡∏¥‡∏Å <strong>Add Members</strong></li>
                <li>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Bot ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ</li>
                <li>‡πÄ‡∏û‡∏¥‡πà‡∏° Bot ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°</li>
                <li>‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏î ‡πÜ ‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°</li>
                <li>‡∏Ñ‡∏•‡∏¥‡∏Å <strong>"‡∏î‡∏π‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏û‡∏ö"</strong> ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</li>
              </ol>
            </div>

            <button
              @click="getChats"
              :disabled="!botToken || loadingChats"
              class="mb-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50"
            >
              <span v-if="loadingChats">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...</span>
              <span v-else>‡∏î‡∏π‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏û‡∏ö</span>
            </button>

            <div v-if="availableChats && Object.keys(availableChats).length > 0" class="space-y-2">
              <h4 class="font-medium text-gray-900">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:</h4>
              <div v-for="(chat, chatId) in availableChats" :key="chatId" class="flex items-center">
                <input
                  :id="`chat-${chatId}`"
                  v-model="selectedChatId"
                  :value="chatId"
                  type="radio"
                  name="chat"
                  class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"
                />
                <label :for="`chat-${chatId}`" class="ml-3 block text-sm font-medium text-gray-700">
                  {{ chat.title || `Chat ${chatId}` }} ({{ chat.type }})
                  <span class="text-gray-500">- ID: {{ chatId }}</span>
                </label>
              </div>
            </div>

            <div v-if="chatsError" class="mt-2 text-sm text-red-600">
              ‚ùå {{ chatsError }}
            </div>
          </div>
        </div>

        <!-- Step 3: Test Notification -->
        <div class="bg-white shadow rounded-lg mb-6">
          <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900">üß™ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
          </div>
          <div class="p-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö</label>
              <textarea
                v-model="testMessage"
                rows="3"
                placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö (‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)"
                class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
              ></textarea>
            </div>

            <button
              @click="sendTestMessage"
              :disabled="!botToken || !selectedChatId || sendingTest"
              class="mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 disabled:opacity-50"
            >
              <span v-if="sendingTest">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...</span>
              <span v-else>‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö</span>
            </button>

            <div v-if="testResult" class="mt-4 p-4 rounded-md" :class="testResult.success ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'">
              {{ testResult.success ? '‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!' : '‚ùå ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' }}
            </div>
          </div>
        </div>

        <!-- Step 4: Save Settings -->
        <div class="bg-white shadow rounded-lg mb-6">
          <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900">üíæ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h3>
          </div>
          <div class="p-6">
            <div class="bg-green-50 border border-green-200 rounded-md p-4 mb-4">
              <h4 class="font-medium text-green-900 mb-2">‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</h4>
              <ul class="text-sm text-green-800 space-y-1">
                <li><strong>Bot Token:</strong> {{ botToken ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤' }}</li>
                <li><strong>Chat ID:</strong> {{ selectedChatId || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å' }}</li>
                <li><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> {{ getSetupStatus() }}</li>
              </ul>
            </div>

            <button
              @click="saveSettings"
              :disabled="!botToken || !selectedChatId || savingSettings"
              class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50"
            >
              <span v-if="savingSettings">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...</span>
              <span v-else>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
            </button>

            <div v-if="saveResult" class="mt-4 p-4 rounded-md" :class="saveResult.success ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'">
              {{ saveResult.success ? '‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!' : '‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' }}
            </div>
          </div>
        </div>

        <!-- Step 5: Send Notifications -->
        <div class="bg-white shadow rounded-lg">
          <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900">üö® ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
          </div>
          <div class="p-6">
            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
              <button
                @click="sendExpiryNotifications"
                :disabled="!isConfigured || sendingNotification"
                class="inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 disabled:opacity-50"
              >
                <span v-if="sendingNotification">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...</span>
                <span v-else>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</span>
              </button>

              <button
                @click="toggleAutoNotification"
                :disabled="!isConfigured"
                :class="[
                  'inline-flex items-center justify-center px-4 py-2 border text-sm font-medium rounded-md transition-colors',
                  autoNotificationEnabled
                    ? 'border-green-300 text-green-700 bg-green-50 hover:bg-green-100'
                    : 'border-gray-300 text-gray-700 bg-white hover:bg-gray-50',
                  !isConfigured ? 'opacity-50 cursor-not-allowed' : ''
                ]"
              >
                {{ autoNotificationEnabled ? 'üü¢ ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà' : '‚ö™ ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥' }}
              </button>
            </div>

            <div v-if="notificationResult" class="mt-4 p-4 rounded-md" :class="notificationResult.success ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'">
              <div v-if="notificationResult.success">
                <div v-if="notificationResult.message">
                  ‚úÖ {{ notificationResult.message }}
                </div>
                <div v-else>
                  ‚úÖ ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!
                  <div v-if="notificationResult.count" class="mt-1">
                    ‡∏û‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏: {{ notificationResult.count }} ‡πÄ‡∏ö‡∏≠‡∏£‡πå
                  </div>
                </div>
              </div>
              <div v-else>
                <div v-if="notificationResult.message">
                  ‚ùå {{ notificationResult.message }}
                </div>
                <div v-else>
                  ‚ùå ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
const config = useRuntimeConfig()

// State
const botToken = ref('')
const selectedChatId = ref('')
const testMessage = ref('')

const botInfo = ref(null)
const botError = ref('')
const testingBot = ref(false)

const availableChats = ref({})
const chatsError = ref('')
const loadingChats = ref(false)

const testResult = ref(null)
const sendingTest = ref(false)

const saveResult = ref(null)
const savingSettings = ref(false)

const notificationResult = ref(null)
const sendingNotification = ref(false)

const autoNotificationEnabled = ref(false)

// Computed
const isConfigured = computed(() => {
  return botToken.value && selectedChatId.value
})

// Methods
const testBot = async () => {
  testingBot.value = true
  botError.value = ''
  botInfo.value = null

  try {
    console.log('Testing bot with token:', botToken.value)
    console.log('API URL:', `${config.public.apiBase}/telegram/bot-info`)

    const response = await $fetch(`${config.public.apiBase}/telegram/bot-info`, {
      method: 'GET',
      headers: {
        'TELEGRAM_BOT_TOKEN': botToken.value,
        'Content-Type': 'application/json'
      }
    })

    console.log('Bot response:', response)
    console.log('Response type:', typeof response)
    console.log('Response.ok:', response?.ok)

    if (response && response.ok === true) {
      botInfo.value = response
      console.log('Bot info set successfully')
    } else {
      console.log('Bot response failed:', response)
      botError.value = `API ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö: ${JSON.stringify(response)}`
    }
  } catch (error) {
    console.error('Error testing bot:', error)
    botError.value = `‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`
  } finally {
    testingBot.value = false
  }
}

const getChats = async () => {
  loadingChats.value = true
  chatsError.value = ''
  availableChats.value = {}

  try {
    const response = await $fetch(`${config.public.apiBase}/telegram/updates`, {
      headers: {
        'TELEGRAM_BOT_TOKEN': botToken.value
      }
    })

    if (response.ok && response.chats) {
      availableChats.value = response.chats
    } else {
      chatsError.value = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÉ‡∏î ‡πÜ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° Bot ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà'
    }
  } catch (error) {
    chatsError.value = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÑ‡∏î‡πâ'
  } finally {
    loadingChats.value = false
  }
}

const sendTestMessage = async () => {
  sendingTest.value = true
  testResult.value = null

  try {
    const response = await $fetch(`${config.public.apiBase}/telegram/test`, {
      method: 'POST',
      headers: {
        'TELEGRAM_BOT_TOKEN': botToken.value
      },
      body: {
        chatId: selectedChatId.value,
        message: testMessage.value
      }
    })

    testResult.value = response
  } catch (error) {
    testResult.value = { success: false }
  } finally {
    sendingTest.value = false
  }
}

const saveSettings = async () => {
  savingSettings.value = true
  saveResult.value = null

  try {
    // Save to environment variables or database
    // For now, just save to localStorage
    localStorage.setItem('telegram_bot_token', botToken.value)
    localStorage.setItem('telegram_chat_id', selectedChatId.value)

    saveResult.value = { success: true }
  } catch (error) {
    saveResult.value = { success: false }
  } finally {
    savingSettings.value = false
  }
}

const sendExpiryNotifications = async () => {
  sendingNotification.value = true
  notificationResult.value = null

  try {
    const response = await $fetch(`${config.public.apiBase}/telegram/notify-expiry`, {
      method: 'POST',
      headers: {
        'TELEGRAM_BOT_TOKEN': botToken.value,
        'TELEGRAM_CHAT_ID': selectedChatId.value
      }
    })

    notificationResult.value = response
  } catch (error) {
    notificationResult.value = { success: false }
  } finally {
    sendingNotification.value = false
  }
}

const getSetupStatus = () => {
  if (!botToken.value) return '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Bot Token'
  if (!selectedChatId.value) return '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°'
  return '‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô'
}

const toggleAutoNotification = async () => {
  if (!isConfigured.value) return

  try {
    const newStatus = !autoNotificationEnabled.value

    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡∏•‡∏á localStorage
    localStorage.setItem('auto_notification_enabled', newStatus.toString())
    autoNotificationEnabled.value = newStatus

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô environment ‡∏´‡∏£‡∏∑‡∏≠ database (‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)
    notificationResult.value = {
      success: true,
      message: newStatus
        ? '‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß (‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô 00:10)'
        : '‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß'
    }

  } catch (error) {
    notificationResult.value = {
      success: false,
      message: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏î‡πâ'
    }
  }
}

// Load saved settings on mount
onMounted(() => {
  const savedToken = localStorage.getItem('telegram_bot_token')
  const savedChatId = localStorage.getItem('telegram_chat_id')
  const savedAutoNotification = localStorage.getItem('auto_notification_enabled')

  if (savedToken) botToken.value = savedToken
  if (savedChatId) selectedChatId.value = savedChatId
  if (savedAutoNotification) autoNotificationEnabled.value = savedAutoNotification === 'true'
})

// Page meta
useHead({
  title: '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Telegram - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠'
})
</script>